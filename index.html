<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Happy Birthday Ate Mira</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: #ffeff7;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }

  #screen1, #screen3 {
    width: 100%; max-width: 700px; min-height: 100vh;
    display: none;
    flex-direction: column; align-items: center; justify-content: center;
    padding: 20px;
  }

  #screen1.active, #screen3.active {
    display: flex;
  }

:root {
  --cake-color: #a678d4;   
  --icing-color: #8e44ad;  
  --icing-highlight: #c39bd3; 
  --cherry-color: #e63946; 
  --cherry-gloss: #ff6b6b; 
}

   .plate {
      position: absolute;
      bottom: 15px;
      width: 175px;
      height: 90px;
      background: #BFBFBF;
      border-radius: 50%;
      left: 50%;
      transform: translateX(-50%);
    }
 .cake-side {
      position: absolute;
      top: 55px;
      width: 150px;
      height: 90px;
      background: var(--cake-color);
      border-radius: 0 0 50% 50%;
      overflow: hidden;
    }

     .cake-side::before,
    .cake-side::after {
      content: '';
      position: absolute;
      width: 150px;
      height: 90px;
      border-radius: 0 0 50% 50%;
      top: -30px;
    }

    .cake-side::before {
      background: white;
      top: -20px;
    }
   .cake-side::after {
      background: var(--cake-color);
    }

    .cake-top {
      position: absolute;
      top: 20px;
      width: 150px;
      height: 75px;
      background: var(--icing-color);
      border-radius: 50%;
      border-bottom: 4px solid var(--icing-highlight);
    }
 .drips {
      position: absolute;
      display: flex;
      width: 150px;
      height: 70px;
      top: 55px;
    }

    .drip {
      background: var(--icing-color);
      border-radius: 0 0 50% 50% / 0 0 20% 20%;
    }

   .drip:nth-child(1) { height: 50px; width: 20px; }
    .drip:nth-child(2) { height: 50px; width: 15px; }
    .drip:nth-child(3) { height: 50px; width: 20px; }
    .drip:nth-child(4) { height: 60px; width: 25px; }
    .drip:nth-child(5) { height: 65px; width: 25px; }
    .drip:nth-child(6) { height: 50px; width: 20px; }
    .drip:nth-child(7) { height: 60px; width: 15px; }
    .drip:nth-child(8) { height: 35px; width: 10px; }

    .candle {
      position: absolute;
      left: 50%;
      top: 10px;
      transform: translateX(-50%);
      width: 8px;
      height: 50px;
      background: repeating-linear-gradient(
        45deg,
        white,
        white 4px,
        #f96bce 4px,
        #f96bce 6px
      );
      border-radius: 10% 10% 20% 20%;
      z-index: 5;
    }

    .candle::after {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 1px;
      height: 5px;
      background: black;
    }

    .flame {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: -12px;
      height: 10px;
      width: 10px;
      background: #F78F4E;
      border-radius: 50%;
      border: 2px solid yellow;
      animation: flicker 0.15s infinite alternate;
    }

    .flame::before,
    .flame::after {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
    }

    .flame::before {
      top: -10px;
      border-bottom: 10px solid yellow;
    }

    .flame::after {
      top: -6px;
      border-bottom: 10px solid #F78F4E;
    }

    .puff {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.4rem;
      opacity: 0;
      transition: all 1s ease;
      pointer-events: none;
      user-select: none;
      z-index: 12;
    }

  
  #playBtn {
    background: #d6336c;
    color: white;
    border: none;
    padding: 15px 40px;
    border-radius: 25px;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 6px 10px rgba(214,51,108,0.7);
    transition: background 0.3s ease;
    margin-top: 20px;
  }
  #playBtn:hover:not(:disabled) { background: #b52857; }
  #playBtn:disabled { cursor: not-allowed; opacity: 0.6; }

  #instructionText {
    font-size: 1.3rem;
    color: #d6336c;
    font-weight: 600;
    margin-top: 20px;
    user-select: none;
    text-align: center;
  }

  #screen3 video {
    max-width: 100%;
    max-height: 80vh;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    background: black;
  }
</style>
</head>
<body>

<div id="screen1" class="active">
  <div class="box-canvas" id="cake-container">
    <div class="plate"></div>
    <div class="cake-side"></div>
    <div class="cake-top"></div>
   
    <div class="drips">
      <div class="drip"></div><div class="drip"></div><div class="drip"></div><div class="drip"></div>
      <div class="drip"></div><div class="drip"></div><div class="drip"></div><div class="drip"></div>
    </div>

  <div class="cherry-decoration cherry1"></div>
  <div class="cherry-decoration cherry2"></div>
  <div class="cherry-decoration cherry3"></div>
  <div class="cherry-decoration cherry4"></div>
  <div class="cherry-decoration cherry5"></div>
  <div class="cherry-decoration cherry6"></div>
  <div class="cherry-decoration cherry7"></div>
  <div class="cherry-decoration cherry8"></div>
  <div class="cherry-decoration cherry9"></div>


    <div class="candle flame" id="candle"></div>
    <div class="puff" id="puff">ðŸ’¨</div>
  </div>

  <div id="instructionText">Blow the candle Ate Mira ðŸŽ‚ðŸ’¨</div>
  <button id="playBtn" disabled>Play Video</button>
</div>

<div id="screen3">
  <video id="birthdayVideo" controls preload="auto">
    <source src="hbd.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
</div>

<audio id="bgMusic" src="musicBg.mp3" loop></audio>

<script>
  const candle = document.getElementById("candle");
  const puff = document.getElementById("puff");
  const playBtn = document.getElementById("playBtn");
  const instructionText = document.getElementById("instructionText");
  const screen1 = document.getElementById("screen1");
  const screen3 = document.getElementById("screen3");
  const birthdayVideo = document.getElementById("birthdayVideo");
  const bgMusic = document.getElementById("bgMusic");

  let audioContext, analyser, microphone, dataArray;
  let isBlown = false;

  function startMic() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert("Sorry, your browser does not support microphone access.");
      return;
    }
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      audioContext = new AudioContext();
      microphone = audioContext.createMediaStreamSource(stream);
      analyser = audioContext.createAnalyser();
      microphone.connect(analyser);
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);

      // âœ… Start music once mic access is granted
      playBackgroundMusic();

      listenVolume();
    }).catch(e => {
      alert("Microphone access denied or error: " + e.message);
    });
  }

  function listenVolume() {
    if (isBlown) return;

    analyser.getByteFrequencyData(dataArray);
    let values = 0;
    for (let i = 0; i < dataArray.length; i++) values += dataArray[i];
    let average = values / dataArray.length;

    // Detect blowing sound
    if (average > 50) {
      blowOutCandle();
      return;
    }

    requestAnimationFrame(listenVolume);
  }

  function blowOutCandle() {
    if (isBlown) return;
    isBlown = true;

    // Stop background music smoothly
    fadeOutMusic();

    candle.classList.add("blow-out");
    puff.style.opacity = "1";
    puff.style.transform = "translateX(-50%) translateY(-25px)";

    setTimeout(() => {
      candle.classList.remove("flame");
      puff.style.opacity = "0";
      puff.style.transform = "translateX(-50%) translateY(0)";
      playBtn.disabled = false;
      instructionText.textContent = "Candle blown out! Click Play to watch the video ðŸŽ‰";
    }, 1200);
  }

  playBtn.addEventListener("click", () => {
    screen1.classList.remove("active");
    screen3.classList.add("active");
    birthdayVideo.play();
  });

  // âœ… Smooth fade-out of background music
  function fadeOutMusic() {
    const fade = setInterval(() => {
      if (bgMusic.volume > 0.05) {
        bgMusic.volume -= 0.05;
      } else {
        bgMusic.pause();
        bgMusic.currentTime = 0;
        clearInterval(fade);
      }
    }, 100);
  }

  // âœ… Background music control
  function playBackgroundMusic() {
    bgMusic.volume = 0.5;
    bgMusic.play().catch(() => {
      console.log("Autoplay blocked; will start after user interaction.");
    });
  }

  window.onload = startMic;
</script>

</body>
</html>




